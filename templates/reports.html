{% extends "base.html" %}

{% block title %}Reports{% endblock %}

{% block content %}
<div class="feature-page reports-page">
    <h2>System Reports</h2>

    <!-- Metadata -->
    <p><strong>Generated By:</strong> Al Rafi</p>
    <p><strong>Date:</strong> {{ timestamp }}</p>

    <!-- Filters -->
    <form method="GET" action="{{ url_for('reports') }}" class="filter-form">
        <label for="gender">Filter by Gender:</label>
        <select name="gender" id="gender">
            <option value="">All</option>
            <option value="male" {% if request.args.get('gender') == 'male' %}selected{% endif %}>Male</option>
            <option value="female" {% if request.args.get('gender') == 'female' %}selected{% endif %}>Female</option>
        </select>
        <label for="min_confidence">Minimum Confidence:</label>
        <input type="number" name="min_confidence" id="min_confidence" step="0.01" 
               value="{{ request.args.get('min_confidence', '') }}" placeholder="e.g., 50.0">
        <button type="submit" class="btn-filter">Apply Filters</button>
    </form>

    <!-- Dataset Summary -->
    {% if summary %}
    <div class="summary-section">
        <h3>Dataset Summary</h3>
        <ul>
            <li><strong>Total Images:</strong> {{ summary.total_images }}</li>
            <li><strong>Male Detections:</strong> {{ summary.male_count }}</li>
            <li><strong>Female Detections:</strong> {{ summary.female_count }}</li>
            <li><strong>Low-Confidence Detections:</strong> {{ summary.low_confidence }}</li>
        </ul>
    </div>
    {% endif %}

    <!-- Visualization -->
    

    <!-- Filtered Results -->
    {% if results %}
    <div class="results-section">
        <h3>Filtered Results</h3>
        <table>
            <thead>
                <tr>
                    <th>Filename</th>
                    <th>Gender</th>
                    <th>Confidence (%)</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                {% for result in results %}
                <tr>
                    <td>{{ result.filename }}</td>
                    <td>{{ result.gender }}</td>
                    <td>{{ result.confidence }}</td>
                    <td>
                        {% if result.confidence < 50 %}
                        <span class="flagged">Low Confidence</span>
                        {% else %}
                        <span class="ok">OK</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <p>No results found. Adjust your filters and try again.</p>
    {% endif %}

    <!-- Download Report -->
    <form method="POST">
        <button type="submit" class="btn-download">Download Report</button>
    </form>
</div>
{% endblock %}